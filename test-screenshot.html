<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UIBridge Screenshot Test</title>
    <script src="dist/uibridge.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-area {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }
        
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: background 0.2s;
        }
        
        button:hover {
            background: #2563eb;
        }
        
        .success {
            background: #10b981;
        }
        
        .success:hover {
            background: #059669;
        }
        
        .status {
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .status.success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status.error {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status.info {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .config-display {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            margin: 10px 0;
        }
        
        .screenshot-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåâ UIBridge Screenshot Test</h1>
        
        <!-- Test Content -->
        <div id="test-content" class="test-area">
            <h3>üì∏ Test Content Area</h3>
            <p>This colorful area will be captured in screenshots!</p>
            <p>Current time: <span id="current-time"></span></p>
            <button class="success" onclick="updateTime()">Update Time</button>
        </div>
        
        <!-- Configuration -->
        <div>
            <h3>‚öôÔ∏è Current Configuration</h3>
            <div id="config-display" class="config-display">Loading...</div>
            
            <button onclick="configureBasic()">Configure Basic Download</button>
            <button onclick="configureOrganized()">Configure Organized Folders</button>
        </div>
        
        <!-- Screenshot Actions -->
        <div>
            <h3>üì∑ Take Screenshots</h3>
            <button onclick="screenshotElement()">Screenshot Element</button>
            <button onclick="screenshotFullPage()">Screenshot Full Page</button>
            <button onclick="screenshotCustomName()">Custom Name Screenshot</button>
            
            <div id="status" class="status info" style="display: none;"></div>
            
            <!-- Screenshot preview -->
            <div id="preview-container" style="display: none;">
                <h4>Screenshot Preview:</h4>
                <img id="preview-image" class="screenshot-preview" alt="Screenshot preview">
                <p><strong>File saved as:</strong> <span id="file-name"></span></p>
            </div>
        </div>
        
        <!-- Instructions -->
        <div>
            <h3>üìã How It Works</h3>
            <ol>
                <li><strong>Configure:</strong> Set up where screenshots should be saved</li>
                <li><strong>Take Screenshot:</strong> Click any screenshot button</li>
                <li><strong>Auto-Download:</strong> Files will automatically download to your Downloads folder</li>
                <li><strong>Organized:</strong> Files are named with timestamps and organized by folder</li>
            </ol>
            <p><strong>Example file names:</strong></p>
            <ul>
                <li><code>demo_test-content_2024-01-15_14-30-25.png</code></li>
                <li><code>demo_fullpage_2024-01-15_14-30-30.png</code></li>
                <li><code>custom-screenshot-name.png</code></li>
            </ul>
        </div>
    </div>

    <script>
        let bridge;
        
        // Initialize UIBridge
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                // Wait for UIBridge to be available
                while (!window.UIBridge) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                bridge = new UIBridge({
                    debug: true,
                    defaultScreenshotConfig: {
                        autoSave: true,
                        folder: 'uibridge-test',
                        prefix: 'demo',
                        timestamp: true,
                        includeMetadata: false
                    }
                });
                
                await bridge.init();
                updateTime();
                showCurrentConfig();
                
                showStatus('success', 'UIBridge initialized successfully! Screenshots will auto-download.');
                console.log('UIBridge initialized successfully');
            } catch (error) {
                console.error('Failed to initialize UIBridge:', error);
                showStatus('error', `Failed to initialize UIBridge: ${error.message}`);
            }
        });
        
        // Update current time
        function updateTime() {
            document.getElementById('current-time').textContent = new Date().toLocaleString();
        }
        
        // Configuration functions
        function configureBasic() {
            bridge.configureScreenshots({
                autoSave: true,
                folder: 'basic-screenshots',
                prefix: 'screenshot',
                timestamp: true,
                includeMetadata: false
            });
            showCurrentConfig();
            showStatus('success', 'Configured for basic downloads to "basic-screenshots" folder');
        }
        
        function configureOrganized() {
            bridge.configureScreenshots({
                autoSave: true,
                folder: 'organized-test/session-' + new Date().toISOString().substring(0, 10),
                prefix: 'test-screenshot',
                timestamp: true,
                includeMetadata: true
            });
            showCurrentConfig();
            showStatus('success', 'Configured for organized folder structure with metadata');
        }
        
        function showCurrentConfig() {
            const config = bridge.getScreenshotConfig();
            document.getElementById('config-display').textContent = JSON.stringify(config, null, 2);
        }
        
        // Screenshot functions
        async function screenshotElement() {
            try {
                showStatus('info', 'Taking element screenshot...');
                
                const result = await bridge.execute('screenshot', {
                    selector: '#test-content'
                });
                
                showStatus('success', `Element screenshot saved! Check your Downloads folder.`);
                showScreenshotPreview(result.dataUrl, result.fileName);
                
            } catch (error) {
                showStatus('error', `Screenshot failed: ${error.message}`);
            }
        }
        
        async function screenshotFullPage() {
            try {
                showStatus('info', 'Taking full page screenshot...');
                
                const result = await bridge.execute('screenshot', {
                    fullPage: true,
                    format: 'jpeg',
                    quality: 0.8
                });
                
                showStatus('success', `Full page screenshot saved! Check your Downloads folder.`);
                showScreenshotPreview(result.dataUrl, result.fileName);
                
            } catch (error) {
                showStatus('error', `Screenshot failed: ${error.message}`);
            }
        }
        
        async function screenshotCustomName() {
            try {
                showStatus('info', 'Taking screenshot with custom name...');
                
                const customName = `custom-demo-${Date.now()}.png`;
                
                const result = await bridge.execute('screenshot', {
                    selector: '#test-content',
                    saveConfig: {
                        customName: customName,
                        folder: 'custom-screenshots'
                    }
                });
                
                showStatus('success', `Custom named screenshot saved! Check your Downloads folder.`);
                showScreenshotPreview(result.dataUrl, result.fileName);
                
            } catch (error) {
                showStatus('error', `Screenshot failed: ${error.message}`);
            }
        }
        
        // UI helpers
        function showStatus(type, message) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
        }
        
        function showScreenshotPreview(dataUrl, fileName) {
            const previewContainer = document.getElementById('preview-container');
            const previewImg = document.getElementById('preview-image');
            const fileNameSpan = document.getElementById('file-name');
            
            previewImg.src = dataUrl;
            fileNameSpan.textContent = fileName;
            previewContainer.style.display = 'block';
        }
        
        // Update time every second
        setInterval(updateTime, 1000);
    </script>
</body>
</html> 